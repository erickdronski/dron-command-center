# 2026-02-20 — Kalshi Weather Trader Launch

## What happened

Built and deployed a full gopfan2-style weather trading bot on Kalshi (production).
Went from 0 to 27 open positions across 14 cities in one session.

---

## Kalshi API

- **Production base URL:** `https://api.elections.kalshi.com`
- **Demo URL** (`demo-api.kalshi.co`) does NOT work with this API key — key is prod-only
- **Auth:** RSA-PSS SHA256 — headers: `KALSHI-ACCESS-KEY`, `KALSHI-ACCESS-TIMESTAMP`, `KALSHI-ACCESS-SIGNATURE`
- **Prices:** cents (1–99), not decimals
- **Positions:** positive = long YES, negative = long NO
- **API key:** `69d03bf0-4a89-414d-8ecf-d6fe4cfdf183` (stored in script)

---

## Bot — kalshi_weather_trader.py

**Path:** `scripts/kalshi_weather_trader.py` (v3)

### Version history
- **v1:** 7 markets, NOAA 7-day only, no smart sizing, no dedup
- **v2:** Added Open-Meteo 16-day, date-aware blending, smart sizing, position dedup, flip-exit logic
- **v3 (current):** 438 markets, 59 series, 20 cities, daily high/low bucket + threshold markets, monthly snow + rain

### How it works
1. Scans 59 Kalshi weather series → 400+ open markets
2. Parses ticker format: `KXHIGHTHOU-26FEB20-T85` (threshold above) / `B84.5` (1°F bucket)
3. Fetches Open-Meteo 16-day forecast per city (fallback: NOAA 7-day)
4. **Bucket markets:** NOAA forecast IN bucket → BUY YES @ 1¢; OUT → BUY NO @ 1¢
5. **Threshold markets:** NOAA clearly above/below → directional buy
6. Smart sizing: 4% of balance, scaled 1x/1.5x/2x by edge strength
7. Position dedup: won't re-enter existing positions
8. SELL guard: SELL_YES only fires if actually holding YES

### Config
- Entry: ≤15¢ | Exit: ≥70¢ | Max position: $3.00 | Sizing: 4% of balance
- Max trades per run: 20

### Known lesson — SLC v1 mistake
- v1 bought NO on SLC snow markets based on NOAA 7-day showing 15% snow hours
- v2 correctly identified those 7-day readings were misleading — Feb in SLC has 10.5" climo avg
- However: today is Feb 20, only 9 days left in Feb, Open-Meteo 16-day shows 0.0" → NO is actually correct
- **Lesson:** Always check days remaining + forecast window coverage before using climatology supplement

---

## Positions as of 2026-02-20 morning

**Balance:** $0.38 remaining (started with $20.02)

**Daily temp (resolve tonight):**
- `KXHIGHMIA-26FEB20-B78.5` — 48x YES @ 1¢
- `KXHIGHCHI-26FEB20-B47.5` — 14x NO @ 1¢
- `KXHIGHPHIL-26FEB20-B44.5` — 1x YES @ 10¢
- `KXHIGHTSFO-26FEB20-B50.5` — 1x YES @ 3¢
- `KXLOWTDEN-26FEB20-T12` — 12x NO @ 1¢
- `KXLOWTMIA-26FEB20-B64.5` — 10x NO @ 1¢
- `KXLOWTNYC-26FEB20-B34.5` — 1x NO @ 9¢
- + several yesterday (Feb 19) positions already resolved or resolving

**Monthly snow (resolve Feb 28):**
- `KXSLCSNOWM-26FEB` — 201x NO × 3 markets (0.1/0.5/1.0") — core thesis: no snow rest of Feb
- `KXLAXSNOWM-26FEB` — YES × 2, `KXCHISNOWM` YES × 3, `KXNYCSNOWM` YES × 2
- `KXSEASNOWM` YES × 3, `KXHOUSNOWM` YES × 3, `KXDALSNOWM-26FEB-10.0` YES × 1

---

## Cron

**Job ID:** `9645dcd6-0c2f-4d35-bfb1-1dfdbf2b6ff1`
**Schedule:** every 3 hours
**Mode:** `sessionTarget: main`, `payload.kind: systemEvent` (fires into main session)
**Delivery:** none (I handle posting manually)

### Cron delivery bug — FIXED
- Original setup used `isolated` agent + `announce` delivery with channel/to
- Isolated agent tried to call `message action=send` without a valid target → failed
- Fix: switched to `main` session + `systemEvent` so cron fires here and I post directly

---

## Lessons

1. **Kalshi ticker format:** `KXHIGHT{CITY}-{YYMONDD}-{T|B}{threshold}` — T = threshold (above or below determined by title), B = 1°F bucket
2. **Bucket markets are the gopfan2 core play:** 1°F buckets price at ~1-5¢, NOAA point forecast in the bucket = 95%+ EV
3. **Daily markets refresh every day** — fresh 14-city inventory every morning, big opportunity window
4. **Balance depletes fast at 4% sizing with 20 max trades** — may want to either raise balance or lower sizing_pct
5. **Open-Meteo 16-day > NOAA 7-day** for coverage. Use NOAA only as fallback.
6. **Isolated cron agents can't use `message tool`** without explicit channel target in the session — use main session systemEvent instead
7. **Kalshi `position` field:** positive = YES contracts held, negative = NO contracts held
